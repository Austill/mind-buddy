# Render.com Blueprint Configuration
# This file enables one-click deployment of Mind Buddy to Render
# Documentation: https://render.com/docs/blueprint-spec

services:
  # Backend Web Service - Flask + Gunicorn in Docker
  - type: web
    name: mind-buddy-backend
    runtime: docker
    region: ohio
    plan: free
    autoDeploy: true
    dockerfilePath: ./backend/Dockerfile
    startCommand: gunicorn --bind 0.0.0.0:$PORT wsgi:app
    envVars:
      - key: FLASK_ENV
        value: production
      - key: SECRET_KEY
        fromGroup: mind-buddy-prod
      - key: JWT_SECRET_KEY
        fromGroup: mind-buddy-prod
      - key: MONGO_URI
        fromGroup: mind-buddy-prod
      - key: MONGODB_DB_NAME
        value: mind_buddy
      - key: HF_MODEL_NAME
        value: facebook/blenderbot-400M-distill
      - key: MAX_NEW_TOKENS
        value: "100"
      - key: TEMPERATURE
        value: "0.7"
      - key: TOP_P
        value: "0.9"
      - key: LOGGING_LEVEL
        value: INFO

  # Frontend Web Service - React + Vite (served as web service)
  - type: web
    name: mind-buddy-frontend
    runtime: docker
    region: ohio
    plan: free
    autoDeploy: true
    dockerfilePath: ./frontend/Dockerfile
    # For a Docker web service, routing is handled by Render at the service-level; no `routes` block required here.
    envVars:
      - key: VITE_API_BASE_URL
        value: https://mind-buddy-backend.onrender.com
      - key: VITE_API_URL
        value: https://mind-buddy-backend.onrender.com

envVarGroups:
  - name: mind-buddy-prod
    envVars:
      - key: SECRET_KEY
        value: misaro
        sync: false
      - key: JWT_SECRET_KEY
        value: misaro
        sync: false
      - key: MONGO_URI
        value: mongodb+srv://austin:misaro@cluster1.ynxgjwq.mongodb.net/?appName=Cluster1
        sync: false
